sinks:

  # this sends normalized events to dsiem frontend. same as above, this single
  # sink can be used by multiple source logs as long as they have a norm_event_* transform.

  dsiem_frontend:
    type: http
    inputs:
      - norm_event_*
    encoding:
      codec: "json"
    method: post
    uri: http://dsiem-frontend:8080/events
    buffer:
      max_events: 32768
      when_full: "drop_newest"
      type: "memory"
    request:
      retry_attempts: 5

# this sends normalized events to surrealdb. same as above, this doesn't support bulk mode
# note that surrealdb namespace and db must be created beforehand.

# this currently doesn't support setting event_id as surrealdb record ID, references:
# - On the Vector side: https://github.com/vectordotdev/vector/issues/1155
# - On the SurrealDB side: by design ID can't be updated once created: https://github.com/orgs/surrealdb/discussions/2678
# So apps have to manually use event_id instead of the record ID.

  surrealdb:
    type: http
    inputs:
      - norm_event_*
    encoding:
      codec: "json"
    method: post
    uri: http://surrealdb:8000/key/event
    # this doesn't work because of the above mentioned issue
    # uri: http://surrealdb:8000/key/event/{{ event_id }}
    batch:
      max_events: 1
    request:
      headers: { 
        "Content-Type": "application/json",
        "Accept": "application/json",
        "NS": "default",
        "DB": "dsiem"
      }
    framing:
      method: "newline_delimited"
